<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body layout:fragment="content">
    <table border="1">
       <tr>
          <td>ì†Œí†µ</td>
       </tr>
       <tr>
          <td>ë‹‰ë„¤ì„</td>
          <td><span th:if="${cboard.nickname != null}" th:text="${cboard.nickname.id}"></span></td>
       </tr>
       <tr>
          <td>ì œëª©</td>
          <td>[[${cboard.ctitle}]]</td>
          <td th:if="${cboard.mdate == null}">ì‘ì„±ì¼ : [[${#temporals.format(cboard.wdate, 'yyyy-MM-dd HH:mm')}]]</td>
          <td th:if="${cboard.mdate != null}">ìˆ˜ì •ì¼ : [[${#temporals.format(cboard.mdate, 'yyyy-MM-dd HH:mm')}]]</td>
          <td>ì¡°íšŒìˆ˜ : [[${cboard.view}]]</td>
       </tr>
       <tr>
          <td>ë‚´ìš©</td>
          <td th:utext="${cboard.cbody}"></td>
       </tr>
       <tr>
          <td>
          <a href="javascript:void(0);" class="recommend"
          th:data-uri="@{|/cboard/vote/${cboard.id}|}">ê³µê°
          <span th:text="${#lists.size(cboard.voter)}"></span>
          </a>
			<a th:href="@{|/cboard/mdate/${cboard.id}|}" th:text="ìˆ˜ì •"
          sec:authorize="isAuthenticated()"
          th:if="${cboard.nickname != null and #authentication.getPrincipal().getUsername() == cboard.nickname.id}"></a>
          
          <a href="javascript:void(0);" class="delete" th:data-uri="@{|/cboard/delete/${cboard.id}|}"
          sec:authorize="isAuthenticated()" th:if="${cboard.nickname != null and #authentication.getPrincipal().getUsername() == cboard.nickname.id}"
          th:text="ì‚­ì œ"></a>
          </td>
       </tr>
       <tr>
          <td>[[|${#lists.size(cboard.replyList)}ê°œì˜ ëŒ“ê¸€ì´ ìˆìŠµë‹ˆë‹¤ğŸ˜Š|]]</td>
       </tr>
       
       <!-- ëŒ“ê¸€ -->
       <tr th:each="reply, loop : ${paging}">
       <div th:if="${cboard.id == reply.cboard.id}">
          <td>ëŒ“ê¸€/ì‘ì„±ì</td>
          <td><span th:if="${reply.nickname != null}" th:text="${reply.nickname.id}"></span></td>
          
          <td>[[${reply.rbody}]]</td>
          <td><a href="javascript:void(0);" class="recommend" th:data-uri="@{|/reply/vote/${reply.id}|}">ê³µê°
          <span th:text="${#lists.size(reply.voter)}"></span>
          </a></td>
          
          <td th:if="${reply.mdate == null}" >ì‘ì„±ì¼ : [[${#temporals.format(reply.wdate, 'yyyy-MM-dd HH:mm')}]]</td>
          <td th:if="${reply.mdate != null}">ìˆ˜ì •ì¼ : [[${#temporals.format(reply.mdate, 'yyyy-MM-dd HH:mm')}]]</td>
          
          <td>
          <a th:href="@{|/reply/mdate/${reply.id}|}"
          sec:authorize="isAuthenticated()" th:if="${reply.nickname != null and #authentication.getPrincipal().getUsername() == reply.nickname.id}"
          th:text="ìˆ˜ì •"></a>
          
          <a href="javascript:void(0);" th:data-uri="@{|/reply/delete/${reply.id}|}" class="delete"
          sec:authorize="isAuthenticated()"  th:if="${reply.nickname != null and #authentication.getPrincipal().getUsername() == reply.nickname.id}" 
          th:text="ì‚­ì œ"></a>
          </td>
       </div>
       </tr>
       <tr>
       
       <!-- ëŒ“ê¸€ ì‘ì„± -->
          <td>ì‘ì„±</td>
          <td>
             <form th:action="@{|/reply/create/${id}|}" th:object="${replyFormDto}" method="post">
               <div th:replace="~{form_errors :: formErrorsFragment}"></div>
                   <textarea sec:authorize="isAnonymous()" disabled th:field="*{rbody}" rows="10" cols="50" placeholder="ëŒ“ê¸€ì‘ì„±"></textarea>
                   <textarea sec:authorize="isAuthenticated()" th:field="*{rbody}" rows="10" cols="50" placeholder="ëŒ“ê¸€ì‘ì„±"></textarea>
                <input type="submit" value="ë‹µë³€ë“±ë¡">
            </form>        
          </td>
       </tr>
       <tr>
       	 <td><button><a th:href="@{|/cboard/list|}">ë©”ì¸ìœ¼ë¡œ</a></button></td>
       </tr>
    </table>
    <table border="1">
      <div th:if="${paging}">
         <tr style="list-style: none;">
            <td th:classappend="${!paging.hasPrevious}? 'disabled'">
               <a th:href="@{|?page=${paging.number-1}|}">
                  <span>ì´ì „</span>
               </a>
            </td>
            <td th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
               th:if="${page >= paging.number-3 and page <= paging.number+3}"
               th:classappend="${page == paging.number} ? 'active'">
               <a th:text="${page}" th:href="@{|?page=${page}|}"></a>
            </td>
            <td th:classappend="${!paging.hasNext} ? 'disabled'">
            <a th:href="@{|?page=${paging.number+1}|}">
               <span>ë‹¤ìŒ</span>
            </a>
            </td>
         </tr>
      </div>
   </table>
</body>
<script layout:fragment="script" type='text/javascript'>
// ê²Œì‹œê¸€ + ëŒ“ê¸€ ì‚­ì œ
const delete_elements = document.getElementsByClassName("delete");
Array.from(delete_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            location.href = this.dataset.uri;
        };
    });
});
// ê²Œì‹œê¸€ ì¶”ì²œ
const recommend_elements = document.getElementsByClassName("recommend");
Array.from(recommend_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("ì¶”ì²œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            location.href = this.dataset.uri;
        };
    });
});
</script>
</html>